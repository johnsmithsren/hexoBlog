---

title: 从Egg.js到Nest.js谈起
date: 2024-12-08 20:05:03
categories:
  - 后端开发
tags:
  - Node.js
  - Egg.js
  - Nest.js
  - TypeScript
cover: https://johnsmithsren.github.io/renjmBlog.github.io/images/young.png
---

## 引言

在 Node.js 后端开发的演进过程中，从最初的 Express.js，到 Koa.js，再到现在广受欢迎的 Egg.js 和 Nest.js，每一个框架都代表着不同的开发理念和实践方向。今天，我们就来聊聊 Egg.js 和 Nest.js 这两个优秀的框架。

## 如何选择？

1. **选择 Egg.js 的场景**

- 团队主要使用 JavaScript
- 需要快速开发
- 重视开发约定
- 需要中文社区支持
- 项目规模中等

2. **选择 Nest.js 的场景**

- 团队熟悉 TypeScript
- 项目架构复杂
- 需要依赖注入
- 考虑微服务架构
- 大型项目

## 开发心得

在使用 Egg.js 和 Nest.js 进行项目开发的几年中，我深刻体会到项目的可维护性远比业务逻辑本身更为重要。以下是几个关键的开发要点：

1. **参数校验**
   前后端双重校验是不可或缺的。严格的参数校验能够有效预防线上错误，降低维护成本。在开发阶段投入校验机制的时间和精力，将在生产环境中获得丰厚的回报。

2. **日志系统**
   框架提供的日志功能往往需要根据具体项目进行定制。一个完善的日志系统应包含：

   - 详细的参数信息，body，query，param
   - 准确的日志行号
   - 完整的错误堆栈
     线上环境中，详尽的日志信息往往是快速定位和解决问题的关键。

3. **部署流程**

   - 大型项目：推荐使用 Jenkins 等 CI/CD 工具
   - 小型项目：可以采用 shell 脚本实现部署，快速便捷

   ```bash
    # 示例部署流程
    1. 打包编译后的文件
    2. 传输到目标服务器
    3. 解压并安装依赖
    4. 启动服务
   ```

4. **配置管理**
   配置文件的重要性常常被低估。我特别欣赏 Nest.js 的配置方案：
   - 使用 .env 文件管理环境变量
   - 配置文件与编译文件分离
   - 手动管理敏感配置
   - 支持多环境配置
5. **存储空间管理**

在后端开发中，存储空间管理是一个容易被忽视但极其重要的话题。之所以重要，是因为存储空间管理一旦部署后，就不好改动了，比如数据库的配置，一旦运行，就很难改动，就得等到停服维护的时候，去进行升降配了。以下是几个关键注意点：

### 业务层面

- **数据边界控制**

  - 设计业务逻辑时必须考虑数据上限
  - 防止浮点数精度问题
  - 为关键数据设置预警阈值
  - 建立完善的失败处理机制

- **关键业务设计**
  - 遵循"先扣除，后发放"原则
  - 例如：商品交易先确认收款，再发货
  - 所有涉及数据增长的逻辑都要设置合理上限

### 系统层面

- **日志管理**

  - 设置单个日志文件大小上限（建议不超过 100MB）
  - 实现日志分片和轮转机制
  - 配置自动清理过期日志
  - 考虑使用 ELK 等专业日志系统

- **磁盘空间监控**
  - 常用监控工具：gdu、htop、tree、du、df
  - 定期检查关键目录空间占用
  - 设置磁盘使用率预警阈值
  - 建立磁盘空间异常应急预案

### Docker 环境注意事项

- **存储路径配置**
  - 合理设置 data-root 路径
  - 使用数据盘而非系统盘存储数据
  - 配置容器日志轮转策略
  - 监控容器磁盘使用情况

### 最佳实践

1. 提前评估各类数据增长速度
2. 建立完善的监控预警机制
3. 定期检查和清理冗余数据
4. 为核心服务配置独立存储空间
5. 使用云服务器时配置资源告警规则

通过合理的存储空间管理，可以有效预防因存储问题导致的系统异常，确保服务的稳定运行。

## 总结

nestJs 用着很舒服，很方便，推荐，适合大型项目
